<div class="space-y-6 pb-16">
  <div class="flex flex-col md:flex-row md:justify-between md:items-center space-y-4 md:space-y-0">
    <h1 class="text-3xl font-bold text-white">Gestión de Menú</h1>
    <button (click)="openModal()" class="bg-primary-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-primary-700 transition-colors">
      Añadir Producto
    </button>
  </div>

  <!-- Filters -->
  <div class="space-y-4">
    <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
      <div class="relative md:flex-grow">
        <label for="name-search" class="sr-only">Buscar por nombre</label>
        <input 
          id="name-search"
          type="text" 
          placeholder="Buscar producto por nombre..."
          [value]="nameFilter()"
          (input)="updateNameFilter($event)"
          class="w-full bg-slate-700 border border-slate-600 rounded-full py-2 pl-10 pr-10 text-white placeholder-slate-400 focus:ring-primary-500 focus:border-primary-500"
        >
        <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
          <svg class="w-5 h-5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
        </div>
        @if (nameFilter()) {
          <button (click)="clearNameFilter()" type="button" class="absolute inset-y-0 right-0 flex items-center pr-3 text-slate-400 hover:text-white">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
          </button>
        }
      </div>
    </div>
    <div class="flex flex-wrap gap-2 pb-2">
      @for(category of uniqueCategories(); track category) {
        <button 
          (click)="setCategoryFilter(category)"
          [class.bg-primary-600]="categoryFilter() === category"
          [class.text-white]="categoryFilter() === category"
          [class.bg-slate-700]="categoryFilter() !== category"
          [class.text-slate-300]="categoryFilter() !== category"
          class="px-4 py-2 text-sm font-medium rounded-full hover:bg-primary-500 transition-colors">
          {{ category }}
        </button>
      }
    </div>
  </div>

  <!-- Mobile Card View -->
  <div class="md:hidden space-y-4">
    @for(product of filteredProducts(); track product.id) {
      <div class="bg-slate-800 rounded-xl shadow-lg p-4">
        <div class="flex items-center gap-4">
          <img class="w-16 h-16 rounded-md object-cover flex-shrink-0" [src]="product.imageUrl" [alt]="product.name">
          <div class="flex-grow">
            <h3 class="font-semibold text-white">{{ product.name }}</h3>
            <p class="text-sm text-slate-400">{{ product.category }}</p>
            <p class="text-lg font-bold text-primary-400 mt-1">{{ product.price | currency:'MXN':'symbol-narrow' }}</p>
          </div>
        </div>
        <div class="mt-4 pt-4 border-t border-slate-700 flex justify-between items-center">
          <div>
            @if(product.active) {
              <span class="px-2 py-1 text-xs font-medium rounded-full bg-green-500/20 text-green-300">Activo</span>
            } @else {
              <span class="px-2 py-1 text-xs font-medium rounded-full bg-red-500/20 text-red-300">Inactivo</span>
            }
          </div>
          <div class="space-x-3">
            <button (click)="openModal(product)" class="font-medium text-primary-500 hover:underline text-sm">Editar</button>
            <button (click)="requestDelete(product)" class="font-medium text-red-500 hover:underline text-sm">Eliminar</button>
          </div>
        </div>
      </div>
    } @empty {
      <div class="text-center py-16 bg-slate-800 rounded-xl">
        <p class="text-slate-400">No se encontraron productos con los filtros seleccionados.</p>
      </div>
    }
  </div>

  <!-- Desktop Table View -->
  <div class="hidden md:block bg-slate-800 rounded-xl shadow-lg overflow-hidden">
    <div class="overflow-x-auto">
      <table class="w-full text-sm text-left text-slate-300">
        <thead class="text-xs text-slate-400 uppercase bg-slate-700/50">
          <tr>
            <th scope="col" class="px-6 py-3">Producto</th>
            <th scope="col" class="px-6 py-3">Categoría</th>
            <th scope="col" class="px-6 py-3">Precio</th>
            <th scope="col" class="px-6 py-3">Estado</th>
            <th scope="col" class="px-6 py-3"><span class="sr-only">Acciones</span></th>
          </tr>
        </thead>
        <tbody>
          @for(product of filteredProducts(); track product.id) {
            <tr class="border-b border-slate-700 hover:bg-slate-700/30">
              <th scope="row" class="px-6 py-4 font-medium text-white whitespace-nowrap flex items-center space-x-3">
                <img class="w-10 h-10 rounded-full object-cover" [src]="product.imageUrl" [alt]="product.name">
                <span>{{ product.name }}</span>
              </th>
              <td class="px-6 py-4">{{ product.category }}</td>
              <td class="px-6 py-4">{{ product.price | currency:'MXN':'symbol-narrow' }}</td>
              <td class="px-6 py-4">
                @if(product.active) {
                  <span class="px-2 py-1 text-xs font-medium rounded-full bg-green-500/20 text-green-300">Activo</span>
                } @else {
                  <span class="px-2 py-1 text-xs font-medium rounded-full bg-red-500/20 text-red-300">Inactivo</span>
                }
              </td>
              <td class="px-6 py-4 text-right space-x-2">
                <button (click)="openModal(product)" class="font-medium text-primary-500 hover:underline">Editar</button>
                <button (click)="requestDelete(product)" class="font-medium text-red-500 hover:underline">Eliminar</button>
              </td>
            </tr>
          } @empty {
            <tr>
              <td colspan="5" class="text-center py-16">
                <p class="text-slate-400">No se encontraron productos con los filtros seleccionados.</p>
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- Add/Edit Modal -->
@if (isModalOpen()) {
  <div class="fixed inset-0 bg-black/70 z-50 flex justify-center items-center p-4">
    <div class="bg-slate-800 rounded-xl shadow-lg w-full max-w-lg max-h-full overflow-y-auto">
      <form [formGroup]="productForm" (ngSubmit)="saveProduct()">
        <div class="p-6">
          <h3 class="text-xl font-semibold text-white">
            {{ editingProduct() ? 'Editar' : 'Añadir' }} Producto
          </h3>
        </div>
        <div class="p-6 space-y-4 border-y border-slate-700">
          <div>
            <label for="name" class="block mb-2 text-sm font-medium text-slate-300">Nombre</label>
            <input type="text" formControlName="name" class="w-full bg-slate-700 border border-slate-600 rounded-lg py-2 px-3 text-white focus:ring-primary-500 focus:border-primary-500">
          </div>
          <div>
            <label for="description" class="block mb-2 text-sm font-medium text-slate-300">Descripción</label>
            <textarea formControlName="description" rows="3" class="w-full bg-slate-700 border border-slate-600 rounded-lg py-2 px-3 text-white focus:ring-primary-500 focus:border-primary-500"></textarea>
          </div>
          <div class="grid grid-cols-2 gap-4">
             <div>
                <label for="category" class="block mb-2 text-sm font-medium text-slate-300">Categoría</label>
                <select formControlName="category" class="w-full bg-slate-700 border border-slate-600 rounded-lg py-2 px-3 text-white focus:ring-primary-500 focus:border-primary-500">
                  <option value="" disabled>Seleccione una categoría</option>
                  @for(category of predefinedCategories; track category) {
                    <option [value]="category">{{ category }}</option>
                  }
                </select>
             </div>
             <div>
                <label for="price" class="block mb-2 text-sm font-medium text-slate-300">Precio</label>
                <input type="number" formControlName="price" class="w-full bg-slate-700 border border-slate-600 rounded-lg py-2 px-3 text-white focus:ring-primary-500 focus:border-primary-500">
             </div>
          </div>
           <div>
            <label for="imageUrl" class="block mb-2 text-sm font-medium text-slate-300">URL de la Imagen</label>
            <input type="url" formControlName="imageUrl" class="w-full bg-slate-700 border border-slate-600 rounded-lg py-2 px-3 text-white focus:ring-primary-500 focus:border-primary-500">
          </div>
          <div>
              <label class="inline-flex items-center cursor-pointer">
                <input type="checkbox" formControlName="active" class="sr-only peer">
                <div class="relative w-11 h-6 bg-slate-600 rounded-full peer peer-focus:ring-4 peer-focus:ring-primary-800 peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:start-[2px] after:bg-white after:border-slate-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary-600"></div>
                <span class="ms-3 text-sm font-medium text-slate-300">Activo</span>
              </label>
          </div>
        </div>
        <div class="p-6 flex items-center justify-end space-x-2">
          <button (click)="closeModal()" type="button" class="text-slate-400 bg-transparent hover:bg-slate-700 rounded-lg text-sm px-5 py-2.5">Cancelar</button>
          <button type="submit" [disabled]="productForm.invalid" class="text-white bg-primary-600 hover:bg-primary-700 font-medium rounded-lg text-sm px-5 py-2.5 disabled:bg-slate-600 disabled:cursor-not-allowed">Guardar</button>
        </div>
      </form>
    </div>
  </div>
}

<!-- Delete Confirmation Modal -->
@if (productToDelete()) {
  <div class="fixed inset-0 bg-black/70 z-50 flex justify-center items-center p-4">
    <div class="bg-slate-800 rounded-xl shadow-lg w-full max-w-md">
      <div class="p-6 text-center">
        <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-900/50 mb-4">
            <svg class="h-6 w-6 text-red-400" stroke="currentColor" fill="none" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
            </svg>
        </div>
        <h3 class="text-lg font-semibold text-white">Eliminar Producto</h3>
        <p class="mt-2 text-sm text-slate-400">
          ¿Estás seguro de que quieres eliminar "{{ productToDelete()?.name }}"? Esta acción no se puede deshacer.
        </p>
      </div>
      <div class="bg-slate-700/50 px-6 py-4 flex justify-end space-x-3 rounded-b-xl">
        <button (click)="cancelDelete()" type="button" class="px-4 py-2 text-sm font-medium text-slate-300 bg-transparent hover:bg-slate-600 rounded-lg transition-colors">
          Cancelar
        </button>
        <button (click)="confirmDelete()" type="button" class="px-4 py-2 text-sm font-medium text-white bg-red-600 hover:bg-red-700 rounded-lg transition-colors">
          Sí, eliminar
        </button>
      </div>
    </div>
  </div>
}